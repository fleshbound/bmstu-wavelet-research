\chapter{Обзор существующих решений}

В данном разделе будут рассмотрены существующие решения задачи генерации текстур с использованием шумов.

\section{Шум Перлина}

В \cite{tandm}, \cite{perlin}, \cite{impperlin} метод генерации шума Перлина описан следующим образом:
\begin{enumerate}
	\item задать целочисленную решетку, то есть множество всех точек в пространстве, координаты которых являются целыми числами;
	\item задать массив $P$, содержащий псевдослучайную перестановку, и массив $G$, содержащий псевдослучайный набор градиентов единичной длины;
	\item с помощью хэш-функции $g = H(x, y, z)$, использующей массивы $P$ и $G$, связать с каждой точкой куба целочисленной решентки псевдослучайный градиент;
	\item выполнить интерполяцию по трем направлениям восьми скалярных произведений $g_{i, j, k} \cdot (x - i, y - j, z - k)$, где $i, j, k$  --- координаты точек куба целочисленной решетки, а $g_{i, j, k}$ --- градиент в точке $(i, j, k)$.
\end{enumerate}

В \cite{impperlin} уточняется, что в оригинальной версии алгоритма генерации шума Перлина для интерполяции по трем направлениям была выбрана функция сглаживания
\begin{equation}
	\label{eq:old_s_func}
	s(t) = 3t^2 - 2t^3,
\end{equation}
где $t$ --- это значение координаты точки. Вторая производная функции (\ref{eq:old_s_func}) $6 - 12t$ не равна нулю при $t = 0$ и $t = 1$. 
Это ненулевое значение создает на выровненных по координатам гранях соседних кубических ячеек разрывы второго рода  \cite{impperlin}, влияние которых на внешний вид полученной текстуры отображено на рисунке \ref{img:old_interpolant}.

Для решения этой проблемы функция (\ref{eq:old_s_func}) заменяется на
\begin{equation}
	\label{eq:new_s_func}
	6t^5 - 15t^4 + 10t^3,
\end{equation}
так как ее первая и вторая производные равны нулю при $t = 0$ и $t = 1$ \cite{impperlin}. 
На рисунке \ref{img:new_interpolant} из \cite{impperlin} приведен результат замены функции сглаживания.

\includeimage{old_interpolant} {f} {H} {95mm}%{height=0.3\textheight} 
{Шум Перлина, полученный с использованием функции сглаживания (\ref{eq:old_s_func}), рисунок Кена Перлина \cite{impperlin}}

\includeimage{new_interpolant} {f} {H} {95mm}%{height=0.3\textheight}
{Шум Перлина, полученный с использованием функции сглаживания (\ref{eq:new_s_func}), рисунок Кена Перлина \cite{impperlin}}

Следующей проблемой, описанной в \cite{impperlin}, является то, что в массиве $G$ содержатся градиенты единичной длины, но в кубической решетке расстояния от центра куба до его ребер укорочены вдоль осей и удлинены вдоль диагоналей между противоположными углами куба. 
Это приводит к тому, что близлежащие градиенты сливаются друг с другом, из-за чего шумовая функция принимает аномально высокие значения в этих областях \cite{impperlin}, что отображено на рисунке \ref{img:old_g} из \cite{impperlin}. 

Для решения данной проблемы массив $G$ заменяют набором из 12 векторов, определяющих направления от центра куба до его ребер. 
Чтобы избежать затрат на деление на 12, Перлином предложено увеличить набор до 16 градиентов, добавляя в него дополнительные $(1,1,0)$, $(-1,1,0)$, $(0,-1,1)$ и $(0,-1,-1)$ \cite{impperlin}. 
На рисунке \ref{img:new_g} из \cite{impperlin} приведен результат замены массива градиентов $G$.

\includeimage{old_g} {f} {H} {70mm}%{0.3\textheight}
{Шум Перлина, полученный с использованием старого массива градиентов $G$, рисунок Кена Перлина \cite{impperlin}}

\includeimage{new_g} {f} {H} {70mm}%{\textheight}
{Шум Перлина, полученный с использованием нового массива градиентов $G$, рисунок Кена Перлина \cite{impperlin}}

\section{Анизотропный шум}

Генерация анизотропного шума \cite{feng2008anisotropic} на поверхности разбивается на несколько этапов:
\begin{enumerate}
	\item задание метрики,
	\item генерация эллипсов,
	\item применение фильтра Гаусса.
\end{enumerate}

Далее перечисленные этапы рассматриваются более подробно.

\subsection{Задание метрики}

Тензорное поле --- это отображение, которое каждой точке рассматриваемого пространства ставит в соответствие тензор \cite{math1965}.

Число $\lambda$ называется собственным значением тензора $A$, если найдется вектор $x$ такой, что $A \cdot x = \lambda \cdot x$.
Вектор $x$ называется собственным вектором тензора $A$, соответствующим данному собственному значению \cite{vectorsmatrices}.

Для первого этапа генерации образца анизотопного шума для визуализации тензорного поля $T$, определенного в пространстве $D \in R^2$, необходима метрика $g$, которая задает свойства образца анизотопного шума \cite{feng2008anisotropic}.
В тензорном поле $T$ $\lambda_1$ и $\lambda_2$ --- собственные значения, $v_1$ и $v_2$ --- соответствующие собственные векторы.
Метрика для генерации образца определяется как

\begin{equation}\label{eq:metrics_g}
	g = \frac{1}{\sqrt{\lambda_1}}\cdot v_1\cdot v_1^T + \frac{1}{\sqrt{\lambda_2}}\cdot v_2\cdot v_2^T
\end{equation}

Полученные образцы представляют собой эллипсы, выровненные по $v_1$ и $v_2$ и масштабируемые по $\lambda_1$ и $\lambda_2$ \cite{feng2008anisotropic}.

\subsection{Генерация эллипсов}

Эллипсы определяются полуосями и центром.

Согласно \cite{feng2008anisotropic} полуоси совпадают с собственными векторами, а квадраты главных радиусов масштабируются по обратным собственным значениям:

\begin{equation}\label{eq:a_square}
	a^2(x_0,y_0)=\frac{1}{\lambda_1(x_0,y_0)}
\end{equation}

\begin{equation}\label{eq:b_square}
	b^2(x_0,y_0)=\frac{1}{\lambda_2(x_0,y_0)}
\end{equation}

В произвольно заданном наборе точек генерируется эллипс --- произвольная точка выбирается как центр текущего эллипса \cite{feng2008anisotropic}.
Произвольным образом выбирается центр первого генерируемого эллипса.
Затем точки, находящиеся внутри границ сгенерированного эллипса, помечаются как неподходящие, так как сгенерированные на них эллипсы будут пересекаться.

Далее начинается перебор еще не обработанных точек --- тех, на которых еще не сгенерирован эллипс или не отмечены, как неподходящие.

На текущей итерации на выбранной точке строится эллипс.

На рисунке \ref{img:choose_ellipses} показан процесс отбора эллипсов для образца.

\includeimage{choose_ellipses} {f} {H} {110mm}%{\textheight}
{Выбор подходящего для выборки эллипса}

Если эллипс пересекается с уже построенными эллипсами, точка его центра помечается как неподходящая. Если не пересекается, точка центра помечается как центр эллипса, а точки внутри границы текущего эллипса помечаются как неподходящие.

\subsection{Применение фильтра Гаусса}

Фильтр Гаусса --- способ снижения детализации изображения и шума в изображении \cite{mitskikh2018}.
В фильтре Гаусса используется функция Гаусса, которая для каждого пикселя вычисляет преобразование.
Пиксель задан набором $(x,y)$, $\sigma$ --- среднеквадратичное отклонение нормального распределения.

Функция Гаусса согласно \cite{haddad1991class}:

\begin{equation}\label{eq:gauss_fn}
	G(x,y)=\frac{1}{2\pi\sigma^2}e^{-\frac{x^2+y^2}{2\sigma^2}}
\end{equation}

Для получения готовой текстуры необходимо применить к образцу фильтр Гаусса.
На рисунке \ref{img:gauss_filter} представлены примеры образца до применения фильтра Гаусса и после.

\includeimage{gauss_filter} {f} {H} {90mm}%{\textheight}
{Образец без применения фильтра Гаусса (слева), с применением фильтра Гаусса (справа)}

\section{Вейвлет-шум}

\subsection{Математические основы}

Суть вейвлет-шума заключается в использовании вейвлетов.

Вейвлет --- функция независимой переменной, имеющая вид короткой волны (всплеска) \cite{Kryzhevich,Smolentsev,Malla}. Пример вейвлета представлен на рисунке \ref{img:wavelet_example}.

\includeimage{wavelet_example} {f} {H} {110mm}%{\textheight}
{Вейвлет, центр которого $x=0$}

Центр вейвлета --- значение независимой переменной, через которое проходит вертикальная ось симметрии вейвлета.

Пространство вейвлетов $W$ --- набор функций, которые могут быть представлены линейной комбинацией сдвигов и масштабирования одного вейвлета \cite{Novikov,Meyer}.

Пример пространства вейвлетов представлен на рисунке \ref{img:wavelet_family}.

\includeimage{wavelet_family} {f} {H} {110mm}%{\textheight}
{Пространство вейвлетов}

Масштабирующая функция $\xi$ --- функция, для которой справедливо следующее равенство:

\begin{equation}\label{eq:refine}
	\xi(x)=\sum_{k}p_k\xi(2x-k),
\end{equation}

при условии, что существуют такие числовые коэффициенты $p_k$ \cite{pixar,Novikov}.

Согласно \cite{pixar}, если $\phi(x)$ --- функция из $W$, центр которой $x=0$, то любая функция $F(x)$ может быть представлена следующим образом:

\begin{equation}\label{eq:F}
	F(x)=\sum_{i}f_i\phi(x-i),
\end{equation}

где $\phi(x-i)$ --- функция из $W$ с центром $x=i$, $f_i$ --- некоторые числовые коэффициенты.

Пространство $S^0$ --- пространство, состоящее из функций вида \ref{eq:F}.

Функции $G(x)$ вида

\begin{equation}\label{eq:G}
	G(x)=\sum_{i}g_i\phi(2x-i)
\end{equation}

аналогично $S^0$ составляют пространство $S^1$. \cite{pixar}

Если рассматриваемая в \ref{eq:G}, \ref{eq:F} функция $\phi$ является масштабирующей, то $S^1$ расширяет $S^0$, то есть включает все функции $S^0$ \cite{pixar,Novikov}.

Вейвлет-анализ --- процесс определения того, расширяет ли пространство $S^1$ пространство $S^0$ \cite{pixar}.

С учетом того, что функция $F(x)$ из \ref{eq:F} является масштабирующей, она представляется с помощью коэффициентов $f_i^{\uparrow}$ в пространстве $S^1$:

\begin{equation}\label{eq:Fup}
	F(x)=\sum_{i}f_i^{\uparrow}\phi(2x-i)
\end{equation}

Коэффициенты $f_i^{\uparrow}$ выражаются с использованием формулы \ref{eq:refine}:

\begin{equation}\label{eq:f_iup}
	f_i^{\uparrow}=\sum_{k}p_{i-2k}f_k
\end{equation}
%Повышение разрешения функции $F(x)$ (вдвое) --- вычисление коэффициентов $f_i^{\uparrow}$.

Согласно \cite{pixar}, коэффициенты $g_i^{\downarrow}$, необходимые для представления функции $G(x)$ из \ref{eq:G} в пространстве $S^0$, вычисляются с помощью вейвлет-анализа и являются равными

\begin{equation}\label{eq:g_idown}
	g_i^{\downarrow}=\sum_{k}a_{k-2i}g_k
\end{equation}

Функция $G(x)$ в пространстве $S^0$ представляется как

\begin{equation}\label{eq:G_divide}
	G(x)=G^{\downarrow}(x) + D(x)
\end{equation}

где $D(x)$ --- функция из $S^1$, которая не может быть выражена в $S^0$ через какие-либо коэффициенты, а $G^{\downarrow}$ выражается через $g_i^{\downarrow}$.
%Понижение разрешения функции $G(x)$ (вдвое) --- вычисление коэффициентов $g_i^{\downarrow}$.

\subsection{Описание}

Входные данные вейвлет-шума: функция $B(x)$ из $W$, изображение $R$.

Выходные данные вейвлет-шума: изображение $N$.

Изображение $X$ представляется упорядоченным набором числовых коэффициентов $\dots,x_i,\dots$:

\begin{equation}\label{eq:x_image}
	X=(\dots,x_i,\dots)
\end{equation}

Авторы \cite{pixar} представляют алгоритм вейвлет-шума тремя семантическими шагами:
\begin{enumerate}
	\item получение $R(x)$;% (в пространстве $S^1$);
	\item получение $R^\downarrow(x)$;% (в пространстве $S^0$);
	\item получение $R^{\downarrow\uparrow}(x)$;% (в пространстве $S^1$);
	\item получение $N(x)$.% (в пространстве $S^1$).
\end{enumerate}

Пример визуализации получения результата алгоритма представлен на рисунке \ref{img:wavelet_algorithm}.

\includeimage{wavelet_algorithm} {f} {H} {110mm}%{\textheight}
{Визуализация получения результата алгоритма вейвлет-шума согласно \cite{pixar}}

Рассмотрим представленные шаги более подробно, основываясь на информации из \cite{pixar}.

%\subsubsection{Получение $R$}

Согласно формуле \ref{eq:x_image} изображение $R$ представляется следующим образом:

\begin{equation}\label{eq:R_image}
	R=(\dots,r_i,\dots)
\end{equation}

Аналогично формуле \ref{eq:G} выражается $R(x)$:

\begin{equation}\label{eq:R}
	R=\sum_{i}r_i B(2x-i)
\end{equation}

%\subsubsection{Получение $R^\downarrow$}

Согласно формуле \ref{eq:G_divide}:

\begin{equation}\label{eq:R_divide}
	R(x)=R^{\downarrow}(x)+N(x)
\end{equation}

$N(x)$ выражается из формулы \ref{eq:R_divide} как

\begin{equation}\label{eq:N_divide}
	N(x)=R(x)-R^{\downarrow}(x)
\end{equation}

С помощью формулы \ref{eq:F} выражается

\begin{equation}\label{eq:Rdown}
	R^{\downarrow}(x)=\sum_{i}r_{i}^{\downarrow}B(x-i)
\end{equation}

где $r_{i}^{\downarrow}$ представляются с помощью формулы \ref{eq:g_idown}:

\begin{equation}\label{eq:r_idown}
	r_i^{\downarrow}=\sum_{k}a_{k-2i}r_k
\end{equation}

%\subsubsection{Получение $R^{\downarrow\uparrow}$}

С учетом формулы \ref{eq:Fup} и \ref{eq:Rdown} получается выражение

\begin{equation}\label{eq:Rdownup}
	R^{\downarrow\uparrow}(x)=\sum_{i}r_{i}^{\downarrow\uparrow}B(2x-i),
\end{equation}

где коэффициенты $r_{i}^{\downarrow\uparrow}$ выражаются с учетом формулы \ref{eq:f_iup}:

\begin{equation}\label{eq:r_idownup}
	r_i^{\downarrow\uparrow}=\sum_{k}p_{i-2k}r_k^{\downarrow}
\end{equation}

%\subsubsection{Получение $N$}

C помощью формул \ref{eq:R} и \ref{eq:Rdown} выражение \ref{eq:N_divide} преобразовывается как

\begin{equation}\label{eq:N_1}
	N(x)=\sum_{i}r_{i}B(2x-i)-\sum_{i}r_{i}^{\downarrow}B(x-i)
\end{equation}

С использованием формулы \ref{eq:Rdownup} выражение \ref{eq:N_1} записывается как

\begin{equation}\label{eq:N}
	N(x)=\sum_{i}r_{i}B(2x-i)-\sum_{i}r_{i}^{\downarrow\uparrow}B(2x-i)=\sum_{i}n'_{i}B(2x-i)
\end{equation}

где $n'_i=r_i-r_i^{\downarrow\uparrow}$.

Для получения изображения $N=(\dots,n_i,\dots)$ значение функции $N(x)$ вычисляется при задаваемых значениях $x$.